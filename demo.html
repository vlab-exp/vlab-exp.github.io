<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-12-12 Sat 12:39 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Building a Transition System based Experiment in Elm</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="ojas" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-83QNS9V0VK"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-83QNS9V0VK');
    </script>
</head>
<body>
<div id="content">
<h1 class="title">Building a Transition System based Experiment in Elm</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org8322dd4">1. Introduction</a></li>
<li><a href="#org695316d">2. Basic Transition Systems</a>
<ul>
<li><a href="#org1cd6c2c">2.1. Core Functions</a>
<ul>
<li><a href="#orga8b3de5">2.1.1. Swap</a></li>
<li><a href="#orga4ece60">2.1.2. Order</a></li>
<li><a href="#org8e32919">2.1.3. Out of Order</a></li>
<li><a href="#org95dbf7e">2.1.4. Adjacent Order</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgefa4878">3. Order Machine</a>
<ul>
<li><a href="#org202ce5d">3.1. State</a></li>
<li><a href="#orgb10a93d">3.2. Action</a></li>
<li><a href="#org48bba4c">3.3. Transition Functions</a></li>
<li><a href="#org9640c02">3.4. Output</a></li>
<li><a href="#org071e494">3.5. Experiment Level Transition System</a>
<ul>
<li><a href="#org9054b03">3.5.1. State</a></li>
<li><a href="#org72f2a89">3.5.2. Selections</a></li>
<li><a href="#org576e14a">3.5.3. Get the list of Selected Indices</a></li>
<li><a href="#orgd33e2cd">3.5.4. Actions</a></li>
<li><a href="#org0a3cfd3">3.5.5. Transition Function</a></li>
<li><a href="#org6774ced">3.5.6. View</a></li>
<li><a href="#org9a52620">3.5.7. List View</a></li>
<li><a href="#org6a03d75">3.5.8. Order Button</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd8df3d6">4. Incrementation Changes for Successive Refinement</a>
<ul>
<li><a href="#orgabc2a45">4.1. From Order Machine to Adjacent Order Machine</a>
<ul>
<li><a href="#org3b83968">4.1.1. State</a></li>
<li><a href="#orgab9c72b">4.1.2. Actions</a></li>
<li><a href="#orga9ef28a">4.1.3. Transition Function</a></li>
<li><a href="#org479a9c9">4.1.4. View</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org8322dd4" class="outline-2">
<h2 id="org8322dd4"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
Bubblesort is a sorting algorithm that performs repeated swap
operations in a particular manner to sort a given list.  In the
algodynamics approach we start with the very basic transition system
for swapping two numbers in a list and then build on on top of that
system eventually leading to the bubblesort algorithm.
</p>

<p>
The intermediate systems involved in developing the final bubblesort
algorithm are as follows:
</p>

<dl class="org-dl">
<dt>1. Swap Machine</dt><dd>Swapping any two numbers in a list.</dd>

<dt>2. Order Machine</dt><dd>Swapping numbers that are out of order.</dd>

<dt>3. Adjacent Order Machine</dt><dd><i>Ordering</i> adjacent numbers.</dd>

<dt>4. Bubble Machine</dt><dd>Step-by-ste iteration through the list and
ordering adjacent numbers.  Iteration can be reset at any point
and does not need to terminate.</dd>

<dt>5. Bubblesort Machine</dt><dd>Step-by-step iteration through the list
following the bubblesort algorithm.</dd>
</dl>

<p>
We start by taking the example of <i>Order Machine</i> to demonstrate how
to build a transition system based experiment.  This is followed by
the <i>Adjacent Order Machine</i> where we discuss how we leaverage the
already existing order machine to build the adjacent order machine.
</p>

<p>
In this document we discuss the following:
</p>

<dl class="org-dl">
<dt>1. <a href="#org695316d">Basic Transition Systems</a></dt><dd>Implementing the transition system
that we define on paper as part of designing the experiment.</dd>

<dt>2. <a href="#org1cd6c2c">Core Functions</a></dt><dd>Functions that are used to compose the
transition function.</dd>

<dt>3. <a href="#org071e494">Experiment Level Transition System</a></dt><dd>The experiment level system
is a composition of the basic system along with additional states
required for the user interface.</dd>

<dt>4. <a href="#orgd8df3d6">Incremental changes for succesive refinement</a></dt><dd>In this section
we discuss the <i>Adjacent Order Machine</i> which is a refinment of
the <i>Order Machine</i>.</dd>
</dl>
</div>
</div>

<div id="outline-container-org695316d" class="outline-2">
<h2 id="org695316d"><span class="section-number-2">2</span> Basic Transition Systems</h2>
<div class="outline-text-2" id="text-2">
<p>
Components of a Transition System:
</p>

<ol class="org-ol">
<li>State</li>
<li>Action</li>
<li>Transition Function</li>
<li>Output</li>
</ol>

<p>
The state and action varies according the transition system but the
transition functions are composed of a set of common function.  We
define these functions in a <code>Core</code> module.
</p>
</div>

<div id="outline-container-org1cd6c2c" class="outline-3">
<h3 id="org1cd6c2c"><span class="section-number-3">2.1</span> Core Functions</h3>
<div class="outline-text-3" id="text-2-1">
<p>
All functions required for systems that are defined as successive
refinements that lead to some algorithm are defined in a common
module.
</p>
</div>

<div id="outline-container-orga8b3de5" class="outline-4">
<h4 id="orga8b3de5"><span class="section-number-4">2.1.1</span> Swap</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
The swap function exchanges the numbers at index <code>i</code> and <code>j</code> in the
given list.
</p>

<p>
If <code>lst[i] = x</code> and <code>lst[j] = y</code> then after applying the swap function to
<code>lst</code> we get a list such that:
</p>

<p>
<code>lst[i] = y</code> and <code>lst[j] = x</code>.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="orge02796c"><span style="color: #0000ff;">swap</span> <span style="color: #483d8b;">:</span> <span style="color: #228b22;">Int</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Int</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">List</span> <span style="color: #228b22;">Int</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">List</span> <span style="color: #228b22;">Int</span>
<span style="color: #0000ff;">swap</span> i j array <span style="color: #483d8b;">=</span>
    swapAt i j array
</pre>
</div>
</div>
</div>


<div id="outline-container-orga4ece60" class="outline-4">
<h4 id="orga4ece60"><span class="section-number-4">2.1.2</span> Order</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
The order function swaps numbers at index <code>i</code> and <code>j</code> (i &lt; j) in the list
<code>lst</code> if the numbers at i and j are out of order.
</p>

<p>
The order function assumes that i &lt; j.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="org4a029de"><span style="color: #0000ff;">order</span><span style="color: #483d8b;">:</span> <span style="color: #228b22;">Int</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Int</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">List</span> <span style="color: #228b22;">Int</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">List</span> <span style="color: #228b22;">Int</span>
<span style="color: #0000ff;">order</span> i j lst <span style="color: #483d8b;">=</span>    
    <span style="color: #a020f0;">if</span> (outOfOrder i j lst) <span style="color: #a020f0;">then</span>
        swap i j lst
    <span style="color: #a020f0;">else</span>
        lst
</pre>
</div>
</div>
</div>


<div id="outline-container-org8e32919" class="outline-4">
<h4 id="org8e32919"><span class="section-number-4">2.1.3</span> Out of Order</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
Check if the values in the given indices <code>i</code> and <code>j</code> of the list are
out of order.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="org11f5b30"><span style="color: #0000ff;">outOfOrder</span><span style="color: #483d8b;">:</span> <span style="color: #228b22;">Int</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Int</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">List</span> <span style="color: #228b22;">Int</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Bool</span>
<span style="color: #0000ff;">outOfOrder</span> i j lst <span style="color: #483d8b;">=</span>
    <span style="color: #a020f0;">let</span> ai <span style="color: #483d8b;">=</span> getAt i lst
        aj <span style="color: #483d8b;">=</span> getAt j lst
    <span style="color: #a020f0;">in</span>
        <span style="color: #a020f0;">case</span> (ai<span style="color: #483d8b;">,</span> aj) <span style="color: #a020f0;">of</span>
            (<span style="color: #228b22;">Just</span> x<span style="color: #483d8b;">,</span> <span style="color: #228b22;">Just</span> y) <span style="color: #483d8b;">-&gt;</span>
                (i <span style="color: #483d8b;">&lt;</span> j) <span style="color: #483d8b;">&amp;&amp;</span> (x <span style="color: #483d8b;">&gt;</span> y)
            _ <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">False</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org95dbf7e" class="outline-4">
<h4 id="org95dbf7e"><span class="section-number-4">2.1.4</span> Adjacent Order</h4>
<div class="outline-text-4" id="text-2-1-4">
<p>
The adjacent order function performs <code>order</code>'s the numbers at index
<code>i</code> and <code>i+1</code> (if i and i+1 are valid indices).
</p>

<div class="org-src-container">
<pre class="src src-elm" id="org6e48d70"><span style="color: #0000ff;">adjorder</span><span style="color: #483d8b;">:</span> <span style="color: #228b22;">Int</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">List</span> <span style="color: #228b22;">Int</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">List</span> <span style="color: #228b22;">Int</span>
<span style="color: #0000ff;">adjorder</span> i lst <span style="color: #483d8b;">=</span> 
    <span style="color: #a020f0;">if</span> i <span style="color: #483d8b;">&lt;</span> (<span style="color: #228b22;">List</span><span style="color: #483d8b;">.</span>length lst) <span style="color: #483d8b;">-</span> 1 <span style="color: #a020f0;">then</span> 
        order i (i <span style="color: #483d8b;">+</span> 1) lst 
    <span style="color: #a020f0;">else</span> 
        lst
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgefa4878" class="outline-2">
<h2 id="orgefa4878"><span class="section-number-2">3</span> Order Machine</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org202ce5d" class="outline-3">
<h3 id="org202ce5d"><span class="section-number-3">3.1</span> State</h3>
<div class="outline-text-3" id="text-3-1">
<p>
State of a transition system consists of all the objects that are
relevant to computations involved in the transition system.
</p>

<p>
We define a <code>OrderMachineState</code> type in Elm that defines the state of
the system.
</p>

<p>
In the <i>Order Machine</i> system, the state consists of a list of
numbers.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="org77e9f69"><span style="color: #a020f0;">type</span> <span style="color: #a020f0;">alias</span> <span style="color: #228b22;">OrderMachineState</span> <span style="color: #483d8b;">=</span> <span style="color: #228b22;">List</span> <span style="color: #228b22;">Int</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb10a93d" class="outline-3">
<h3 id="orgb10a93d"><span class="section-number-3">3.2</span> Action</h3>
<div class="outline-text-3" id="text-3-2">
<p>
The <code>Msg</code> type defines the set of inputs to the system.  These
messages are triggered by the <code>Elm Runtime</code> that executes in the
browser.  when a user interacts with the interface by clicking on any
input button, the corresponding message that is defined in the view is
triggered and it is handled by the <code>udpate</code> function.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="org97bae20"><span style="color: #a020f0;">type</span> <span style="color: #228b22;">OrderMachineAction</span> <span style="color: #483d8b;">=</span> <span style="color: #228b22;">Order</span> <span style="color: #228b22;">Int</span> <span style="color: #228b22;">Int</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org48bba4c" class="outline-3">
<h3 id="org48bba4c"><span class="section-number-3">3.3</span> Transition Functions</h3>
<div class="outline-text-3" id="text-3-3">
<p>
The update function maps the messages in the system to the function
that actually performs the transition.  In this function we map each
<code>Action</code> variant to a transition function.
</p>

<p>
The <i>Order Machine</i> consists of the following input messages:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Action</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>Order i j</code></td>
<td class="org-left">Order the numbers at i and j indices in the list.</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-elm" id="orgf7da47f"><span style="color: #0000ff;">orderUpdate</span><span style="color: #483d8b;">:</span> <span style="color: #228b22;">OrderMachineAction</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">OrderMachineState</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">OrderMachineState</span>
<span style="color: #0000ff;">orderUpdate</span> action state <span style="color: #483d8b;">=</span>
    <span style="color: #a020f0;">case</span> action <span style="color: #a020f0;">of</span>
        <span style="color: #228b22;">Order</span> i j <span style="color: #483d8b;">-&gt;</span> order i j state
</pre>
</div>
</div>
</div>


<div id="outline-container-org9640c02" class="outline-3">
<h3 id="org9640c02"><span class="section-number-3">3.4</span> Output</h3>
<div class="outline-text-3" id="text-3-4">
<p>
The output of the transition system is Html code that is rendered by
the browser.
</p>

<p>
The view needs to trigger messages that are not a part of the <i>Order
Machine's</i> basic transition system.  These messages correspond to the
transition system that is required to make the interface work.  So, we
will define the view later when we define that system.  
</p>

<p>
The top level system will consist of the transition system for the
<i>Order Machine</i> as well as the some additional machinery required for
the interface.
</p>
</div>
</div>


<div id="outline-container-org071e494" class="outline-3">
<h3 id="org071e494"><span class="section-number-3">3.5</span> Experiment Level Transition System</h3>
<div class="outline-text-3" id="text-3-5">
<p>
The Experiment Level Transition system is composed of the <i>Basic
Transition System</i> and additional actions to handle the input
interface and output.
</p>
</div>

<div id="outline-container-org9054b03" class="outline-4">
<h4 id="org9054b03"><span class="section-number-4">3.5.1</span> State</h4>
<div class="outline-text-4" id="text-3-5-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Field</th>
<th scope="col" class="org-left">Desciription</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">lst</td>
<td class="org-left">The <code>Order Machine State</code> represents the state space of <i>Order Machine</i>.</td>
</tr>

<tr>
<td class="org-left">selections</td>
<td class="org-left">Used to keep track of selected indices.</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-elm" id="org678c067"><span style="color: #a020f0;">type</span> <span style="color: #a020f0;">alias</span> <span style="color: #228b22;">State</span> <span style="color: #483d8b;">=</span>
    <span style="color: #a020f0;">{</span> lst<span style="color: #483d8b;">:</span> <span style="color: #228b22;">OrderMachineState</span>
    <span style="color: #a020f0;">,</span> selections<span style="color: #483d8b;">:</span> <span style="color: #228b22;">Selections</span>
    <span style="color: #a020f0;">}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org72f2a89" class="outline-4">
<h4 id="org72f2a89"><span class="section-number-4">3.5.2</span> Selections</h4>
<div class="outline-text-4" id="text-3-5-2">
<p>
Selections are used to keep track of the indices that the user selects
by clicking on the corresponding list items.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variant</th>
<th scope="col" class="org-left">Desctiption</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">NoneSelected</td>
<td class="org-left">No list item is selected.</td>
</tr>

<tr>
<td class="org-left">OneSelected i</td>
<td class="org-left">One list item at index i is selected.</td>
</tr>

<tr>
<td class="org-left">BothSelected i j</td>
<td class="org-left">Two list items at index i and j are selected.</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-elm" id="orgf23113e"><span style="color: #a020f0;">type</span> <span style="color: #228b22;">Selections</span>
    <span style="color: #483d8b;">=</span> <span style="color: #228b22;">NoneSelected</span>
    <span style="color: #483d8b;">|</span> <span style="color: #228b22;">OneSelected</span> <span style="color: #228b22;">Int</span>
    <span style="color: #483d8b;">|</span> <span style="color: #228b22;">BothSelected</span> <span style="color: #228b22;">Int</span> <span style="color: #228b22;">Int</span>
</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="orga29af54"></a>Select<br />
<div class="outline-text-5" id="text-3-5-2-1">
<p>
When the user clicks on an unselected list item the state of
selections is updated according to the current state of selections as
follows:
</p>

<dl class="org-dl">
<dt>No Item is Selected</dt><dd>If no item in the list has been selected
before clicking on an item (with index <code>i</code>), then we update the
state of <code>selections</code> to <code>OneSelected i</code>.</dd>

<dt>One Item is Selected</dt><dd>If one item (i) has already been selected
before clicking on an unselected item with index <code>j</code> then we
update the selections state to <code>BothSelected p q</code> where <code>p = (min
     i j)</code> and <code>q = (max i j)</code>.</dd>

<dt>Two items are Selected</dt><dd>If two items are already selected then we
do not change the state.  This is due to the fact that we do not
need more that two items for any list operation in our system.
We require the user to first unselect/deselect one or more
selected items before selecting another item.</dd>
</dl>

<div class="org-src-container">
<pre class="src src-elm" id="org8defcea"><span style="color: #0000ff;">select</span> <span style="color: #483d8b;">:</span> <span style="color: #228b22;">Int</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Selections</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Selections</span>
<span style="color: #0000ff;">select</span> i selections <span style="color: #483d8b;">=</span>
    <span style="color: #a020f0;">case</span> selections <span style="color: #a020f0;">of</span>
        <span style="color: #228b22;">NoneSelected</span> <span style="color: #483d8b;">-&gt;</span>
            <span style="color: #228b22;">OneSelected</span> i
        <span style="color: #228b22;">OneSelected</span> j <span style="color: #483d8b;">-&gt;</span>
            <span style="color: #228b22;">BothSelected</span> (min i j) (max i j)
        <span style="color: #228b22;">BothSelected</span> j k <span style="color: #483d8b;">-&gt;</span>
            <span style="color: #228b22;">BothSelected</span> j k
</pre>
</div>
</div>
</li>

<li><a id="org321e839"></a>Deselect<br />
<div class="outline-text-5" id="text-3-5-2-2">
<p>
When the user clicks on a selected item, the corresponding action of
deselecting the item and updating the state accordingly is handled by
the <code>deselect</code> function.
</p>

<p>
We need to handle three cases that correspond to three states that the
<code>selections</code> can be in before the user clicks on the item:
</p>

<dl class="org-dl">
<dt>No Item is Selected</dt><dd>This is an unreachable state because in order
to click on a selected item, there must exists atleast one
selected item.</dd>

<dt>Only One Item is Selected</dt><dd>In this case we update the selections
state to <code>NoneSelected</code>.</dd>

<dt>Two Items are Selected</dt><dd>In this case we update the selections
state to <code>OneSelected</code>.</dd>
</dl>

<div class="org-src-container">
<pre class="src src-elm" id="org39649c1"><span style="color: #0000ff;">deselect</span> <span style="color: #483d8b;">:</span> <span style="color: #228b22;">Int</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Selections</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Selections</span>
<span style="color: #0000ff;">deselect</span> i selections <span style="color: #483d8b;">=</span>
    <span style="color: #a020f0;">case</span> selections <span style="color: #a020f0;">of</span>

        <span style="color: #228b22;">NoneSelected</span> <span style="color: #483d8b;">-&gt;</span>
            <span style="color: #228b22;">NoneSelected</span>

        <span style="color: #228b22;">OneSelected</span> j <span style="color: #483d8b;">-&gt;</span>
            <span style="color: #a020f0;">if</span> (i <span style="color: #483d8b;">==</span> j) <span style="color: #a020f0;">then</span> 
                <span style="color: #228b22;">NoneSelected</span>
            <span style="color: #a020f0;">else</span>
                <span style="color: #228b22;">OneSelected</span> j

        <span style="color: #228b22;">BothSelected</span> j k <span style="color: #483d8b;">-&gt;</span>
            <span style="color: #a020f0;">if</span> (i <span style="color: #483d8b;">==</span> j) <span style="color: #a020f0;">then</span>
                <span style="color: #228b22;">OneSelected</span> k
            <span style="color: #a020f0;">else</span>
                <span style="color: #a020f0;">if</span> (i <span style="color: #483d8b;">==</span> k) <span style="color: #a020f0;">then</span>
                    <span style="color: #228b22;">OneSelected</span> j
                <span style="color: #a020f0;">else</span> 
                    <span style="color: #228b22;">BothSelected</span> j k
</pre>
</div>
</div>
</li>


<li><a id="org1244e58"></a>Selection Check Predicate<br />
<div class="outline-text-5" id="text-3-5-2-3">
<p>
The <code>isSelected</code> function checks if the item at given index <code>i</code> is
selected or not.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="org69ee13c"><span style="color: #0000ff;">isSelected</span> <span style="color: #483d8b;">:</span> <span style="color: #228b22;">Int</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Selections</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Bool</span>
<span style="color: #0000ff;">isSelected</span> index selections <span style="color: #483d8b;">=</span>
    <span style="color: #a020f0;">case</span> selections <span style="color: #a020f0;">of</span>
        <span style="color: #228b22;">NoneSelected</span> <span style="color: #483d8b;">-&gt;</span>
            <span style="color: #228b22;">False</span>
        <span style="color: #228b22;">OneSelected</span> j <span style="color: #483d8b;">-&gt;</span>
            <span style="color: #a020f0;">if</span> j <span style="color: #483d8b;">==</span> index <span style="color: #a020f0;">then</span> <span style="color: #228b22;">True</span> <span style="color: #a020f0;">else</span> <span style="color: #228b22;">False</span>
        <span style="color: #228b22;">BothSelected</span> j k <span style="color: #483d8b;">-&gt;</span>
            <span style="color: #a020f0;">if</span> (j <span style="color: #483d8b;">==</span> index <span style="color: #483d8b;">||</span> k <span style="color: #483d8b;">==</span> index) <span style="color: #a020f0;">then</span> <span style="color: #228b22;">True</span> <span style="color: #a020f0;">else</span> <span style="color: #228b22;">False</span>
</pre>
</div>
</div>
</li>


<li><a id="org0d67c63"></a>Select Adjacent Items<br />
<div class="outline-text-5" id="text-3-5-2-4">
<p>
When the user clicks on an unselected list item in the <i>Order Adjacent
Machine</i> the <code>adjselect</code> function is triggered.  This function is a
composition of two <code>select</code> functions that select the items at index
<code>i</code> and <code>i+1</code>.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="orgff270a0"><span style="color: #0000ff;">adjselect</span> <span style="color: #483d8b;">:</span> <span style="color: #228b22;">Int</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Selections</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Selections</span>
<span style="color: #0000ff;">adjselect</span> i selections <span style="color: #483d8b;">=</span> 
    selections <span style="color: #483d8b;">|&gt;</span> select i <span style="color: #483d8b;">|&gt;</span> select (i<span style="color: #483d8b;">+</span>1)
</pre>
</div>
</div>
</li>

<li><a id="org4b29013"></a>Deselect Adjacent Selection<br />
<div class="outline-text-5" id="text-3-5-2-5">
<p>
<code>deselect</code> function is composed of two <code>deselect</code> functions that undo
the selection of items at index <code>i</code> and <code>i+1</code>.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="org8d4e623"><span style="color: #0000ff;">adjdeselect</span> <span style="color: #483d8b;">:</span> <span style="color: #228b22;">Int</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Selections</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Selections</span>
<span style="color: #0000ff;">adjdeselect</span> i selections <span style="color: #483d8b;">=</span>
    selections <span style="color: #483d8b;">|&gt;</span> deselect i <span style="color: #483d8b;">|&gt;</span> deselect (i<span style="color: #483d8b;">+</span>1)
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org576e14a" class="outline-4">
<h4 id="org576e14a"><span class="section-number-4">3.5.3</span> Get the list of Selected Indices</h4>
<div class="outline-text-4" id="text-3-5-3">
<p>
<code>selectionsList</code> function converts the <code>Selections</code> datatype to a list
of selected indices.  This required when we want to send the indices
to the list visualization function that does not use the <code>Selections</code>
type.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="org3b9affd"><span style="color: #0000ff;">selectionsList</span> <span style="color: #483d8b;">:</span> <span style="color: #228b22;">Selections</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">List</span> <span style="color: #228b22;">Int</span>
<span style="color: #0000ff;">selectionsList</span> selections <span style="color: #483d8b;">=</span>
    <span style="color: #a020f0;">case</span> selections <span style="color: #a020f0;">of</span>
       <span style="color: #228b22;">NoneSelected</span> <span style="color: #483d8b;">-&gt;</span> []
       <span style="color: #228b22;">OneSelected</span> i <span style="color: #483d8b;">-&gt;</span> [i]
       <span style="color: #228b22;">BothSelected</span> i j <span style="color: #483d8b;">-&gt;</span> [i<span style="color: #483d8b;">,</span> j]
</pre>
</div>
</div>
</div>


<div id="outline-container-orgd33e2cd" class="outline-4">
<h4 id="orgd33e2cd"><span class="section-number-4">3.5.4</span> Actions</h4>
<div class="outline-text-4" id="text-3-5-4">
<p>
The actions in the transition system for Order Machine Experiment
consist of actions for the Order Machine along with actions
corresponding to the buttons in the interface.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Action</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">OrderAction</td>
<td class="org-left">Actions for the Order Machine</td>
</tr>

<tr>
<td class="org-left">Select</td>
<td class="org-left">Action to select an item in the list.</td>
</tr>

<tr>
<td class="org-left">Deselect</td>
<td class="org-left">Action to deselect a selected item in the list.</td>
</tr>
</tbody>
</table>


<div class="org-src-container">
<pre class="src src-elm" id="org4aaebfe"><span style="color: #a020f0;">type</span> <span style="color: #228b22;">Action</span> <span style="color: #483d8b;">=</span> <span style="color: #228b22;">OrderAction</span> <span style="color: #228b22;">OrderMachineAction</span>
            <span style="color: #483d8b;">|</span> <span style="color: #228b22;">Select</span> <span style="color: #228b22;">Int</span>
            <span style="color: #483d8b;">|</span> <span style="color: #228b22;">Deselect</span> <span style="color: #228b22;">Int</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0a3cfd3" class="outline-4">
<h4 id="org0a3cfd3"><span class="section-number-4">3.5.5</span> Transition Function</h4>
<div class="outline-text-4" id="text-3-5-5">
<p>
The transition function for the experiment maps the actions to
corresponding functions that update the state according to the action.
</p>

<dl class="org-dl">
<dt>OrderAction</dt><dd>The OrderAction is triggered when the user clicks on
the order button after selecting the items to order.
This action is forwarded to the transition function
for the order machine to update the list.  Once the
list is updated, the selections are also rest.</dd>

<dt>Select</dt><dd>When the user clicks on a list item that is not selected
already, the state of selections is updated accordingly to
reflect the new selected index.</dd>

<dt>Deselect</dt><dd>When the user clicks on a list item that is already
selected the selection state is updated to deselect the
index.</dd>
</dl>


<div class="org-src-container">
<pre class="src src-elm" id="orgfdc4abd"><span style="color: #0000ff;">update</span><span style="color: #483d8b;">:</span> <span style="color: #228b22;">Action</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">State</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">State</span>
<span style="color: #0000ff;">update</span> action state <span style="color: #483d8b;">=</span>
    <span style="color: #a020f0;">case</span> action <span style="color: #a020f0;">of</span>
        <span style="color: #228b22;">OrderAction</span> m <span style="color: #483d8b;">-&gt;</span> 
            <span style="color: #a020f0;">{</span> state <span style="color: #483d8b;">|</span> lst <span style="color: #483d8b;">=</span> orderUpdate m state<span style="color: #483d8b;">.</span>lst
                    <span style="color: #a020f0;">,</span> selections <span style="color: #483d8b;">=</span> <span style="color: #228b22;">NoneSelected</span>
            <span style="color: #a020f0;">}</span>
        <span style="color: #228b22;">Select</span> i <span style="color: #483d8b;">-&gt;</span> { state <span style="color: #483d8b;">|</span> selections <span style="color: #483d8b;">=</span> select i state<span style="color: #483d8b;">.</span>selections }
        <span style="color: #228b22;">Deselect</span> i <span style="color: #483d8b;">-&gt;</span> { state <span style="color: #483d8b;">|</span> selections <span style="color: #483d8b;">=</span> deselect i state<span style="color: #483d8b;">.</span>selections }
</pre>
</div>
</div>
</div>


<div id="outline-container-org6774ced" class="outline-4">
<h4 id="org6774ced"><span class="section-number-4">3.5.6</span> View</h4>
<div class="outline-text-4" id="text-3-5-6">
<p>
The experiment is provided to the user as a browser based application.
The user interface in a browser based application is defined as html
code.  To present the experiment to the user we define a mapping from
the state of the system to html.  The <code>view</code> function defines this
mapping.
</p>

<p>
The <code>Html</code> package provides functions to define html tags.  the <code>div</code>
function takes two arguments:
</p>

<dl class="org-dl">
<dt>List of Attributes</dt><dd>The list of html attributes for the tag.</dd>
<dt>List of Child Elements</dt><dd>The list of child elements contained
inside the tag.</dd>
</dl>

<p>
The top level div consists of two elements: 
</p>
<ol class="org-ol">
<li><a href="#org9a52620">listview</a> : Html element for the list.</li>
<li><a href="#org6a03d75">orderButton</a> : Html element for the order button.</li>
</ol>

<div class="org-src-container">
<pre class="src src-elm" id="org01a4981"><span style="color: #0000ff;">view</span><span style="color: #483d8b;">:</span> <span style="color: #228b22;">State</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Html</span> <span style="color: #228b22;">Action</span>
<span style="color: #0000ff;">view</span> state <span style="color: #483d8b;">=</span>
    <span style="color: #228b22;">Html</span><span style="color: #483d8b;">.</span>div
        []
        <span style="color: #a020f0;">[</span> listView state
        <span style="color: #a020f0;">,</span> orderButton state
        <span style="color: #a020f0;">]</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org9a52620" class="outline-4">
<h4 id="org9a52620"><span class="section-number-4">3.5.7</span> List View</h4>
<div class="outline-text-4" id="text-3-5-7">
<p>
The <code>listview</code> function defines the html to display the list.  The
visual representation of the list is defined in a module that provides
common functions for visualizing lists.
</p>

<p>
The list view needs to trigger actions for selecting/deselecting list
items.  The action that is triggered on a click is defined as an
attribute of the corresponding element and depends on the state of
<code>selections</code>.  The <code>viewList</code> function takes the list of numbers, list
of selected indices and the action to be triggered when a list item is
clicked.
</p>

<p>
The Action to be triggered on click is defined as follows:
</p>

<dl class="org-dl">
<dt>If no item is selected</dt><dd>If no item is selected then we trigger
<code>Select</code> action.</dd>

<dt>If one or more items are selected</dt><dd>If one or more items are
selected then we trigger <code>Select</code> if the item that is clicked is
not already selected and <code>Deselect</code> if the item is already
selected.</dd>
</dl>


<div class="org-src-container">
<pre class="src src-elm" id="org2229983"><span style="color: #0000ff;">listView</span><span style="color: #483d8b;">:</span> <span style="color: #228b22;">State</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Html</span> <span style="color: #228b22;">Action</span>
<span style="color: #0000ff;">listView</span> {lst<span style="color: #483d8b;">,</span> selections} <span style="color: #483d8b;">=</span>
    <span style="color: #a020f0;">let</span> 
        action <span style="color: #483d8b;">=</span> 
            ( <span style="color: #a020f0;">case</span> selections <span style="color: #a020f0;">of</span> 
                <span style="color: #228b22;">NoneSelected</span> <span style="color: #483d8b;">-&gt;</span> (<span style="color: #483d8b;">\</span>ci <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Select</span> ci)
                <span style="color: #228b22;">OneSelected</span> i <span style="color: #483d8b;">-&gt;</span> (<span style="color: #483d8b;">\</span>ci <span style="color: #483d8b;">-&gt;</span> <span style="color: #a020f0;">if</span> ci <span style="color: #483d8b;">==</span> i <span style="color: #a020f0;">then</span> <span style="color: #228b22;">Deselect</span> ci <span style="color: #a020f0;">else</span> <span style="color: #228b22;">Select</span> ci)
                <span style="color: #228b22;">BothSelected</span> i j <span style="color: #483d8b;">-&gt;</span>  (<span style="color: #483d8b;">\</span>ci <span style="color: #483d8b;">-&gt;</span> <span style="color: #a020f0;">if</span> ci <span style="color: #483d8b;">==</span> i <span style="color: #483d8b;">||</span> ci <span style="color: #483d8b;">==</span> j <span style="color: #a020f0;">then</span> <span style="color: #228b22;">Deselect</span> ci <span style="color: #a020f0;">else</span> <span style="color: #228b22;">Select</span> ci)
            )
    <span style="color: #a020f0;">in</span>
        <span style="color: #228b22;">Html</span><span style="color: #483d8b;">.</span>div
            []
            <span style="color: #a020f0;">[</span> viewList lst (selectionsList selections) action
            <span style="color: #a020f0;">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6a03d75" class="outline-4">
<h4 id="org6a03d75"><span class="section-number-4">3.5.8</span> Order Button</h4>
<div class="outline-text-4" id="text-3-5-8">
<p>
When the user clicks on the order button the <code>Order</code> action is
triggered.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="orgcff057f"><span style="color: #0000ff;">orderButton</span> <span style="color: #483d8b;">:</span> <span style="color: #228b22;">State</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Html</span> <span style="color: #228b22;">Action</span>
<span style="color: #0000ff;">orderButton</span> state <span style="color: #483d8b;">=</span> 
    <span style="color: #a020f0;">let</span>
        attrlst <span style="color: #483d8b;">=</span> <span style="color: #a020f0;">if</span> active state <span style="color: #a020f0;">then</span>
                      activeStyle state<span style="color: #483d8b;">.</span>selections
                  <span style="color: #a020f0;">else</span> 
                      inactiveStyle
    <span style="color: #a020f0;">in</span>
        <span style="color: #228b22;">Html</span><span style="color: #483d8b;">.</span>div []
            <span style="color: #a020f0;">[</span> <span style="color: #228b22;">Html</span><span style="color: #483d8b;">.</span>button
                (commonStyles <span style="color: #483d8b;">++</span> attrlst)
                [<span style="color: #228b22;">Html</span><span style="color: #483d8b;">.</span>text <span style="color: #8b2252;">"ORDER"</span>]
            <span style="color: #a020f0;">]</span>
</pre>
</div>

<p>
The html rendering of the order button depends on the state of
selections as follows:
</p>

<dl class="org-dl">
<dt>Two Selected and Out of Order</dt><dd>If two items are selected and the
numbers in the selected indices are out of order then the order
button is <code>active</code>.</dd>

<dt>Otherwise</dt><dd>If two indices are not selected or if the selected
items are in correct order then the button is
<code>inactive</code>.</dd>
</dl>

<p>
If the button is active then clicking on the button triggers the
<code>Order</code> action in the system.  If the button is inactive then 
</p>

<div class="org-src-container">
<pre class="src src-elm" id="orgee23fde"><span style="color: #0000ff;">inactiveStyle</span> <span style="color: #483d8b;">=</span> [ style <span style="color: #8b2252;">"background"</span> <span style="color: #8b2252;">"#E0E0E0"</span> ]

<span style="color: #0000ff;">activeStyle</span> selections <span style="color: #483d8b;">=</span>
    <span style="color: #a020f0;">case</span> selections <span style="color: #a020f0;">of</span>
        <span style="color: #228b22;">BothSelected</span> i j <span style="color: #483d8b;">-&gt;</span> 
            <span style="color: #a020f0;">[</span> onClick (<span style="color: #228b22;">OrderAction</span> (<span style="color: #228b22;">Order</span> i j))
            <span style="color: #a020f0;">,</span> style <span style="color: #8b2252;">"background"</span> <span style="color: #8b2252;">"#E0F2F1"</span>
            <span style="color: #a020f0;">]</span>
        _ <span style="color: #483d8b;">-&gt;</span> []

<span style="color: #0000ff;">commonStyles</span> <span style="color: #483d8b;">=</span> 
    <span style="color: #a020f0;">[</span> style <span style="color: #8b2252;">"padding"</span> <span style="color: #8b2252;">"0.5em"</span>
    <span style="color: #a020f0;">,</span> style <span style="color: #8b2252;">"font-weight"</span> <span style="color: #8b2252;">"bold"</span>
    <span style="color: #a020f0;">]</span>

<span style="color: #0000ff;">active</span><span style="color: #483d8b;">:</span> <span style="color: #228b22;">State</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Bool</span>
<span style="color: #0000ff;">active</span> state <span style="color: #483d8b;">=</span>
    <span style="color: #a020f0;">case</span> state<span style="color: #483d8b;">.</span>selections <span style="color: #a020f0;">of</span>
        <span style="color: #228b22;">BothSelected</span> i j <span style="color: #483d8b;">-&gt;</span>
            (<span style="color: #228b22;">Core</span><span style="color: #483d8b;">.</span>outOfOrder i j state<span style="color: #483d8b;">.</span>lst)
        _ <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">False</span>            
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-orgd8df3d6" class="outline-2">
<h2 id="orgd8df3d6"><span class="section-number-2">4</span> Incrementation Changes for Successive Refinement</h2>
<div class="outline-text-2" id="text-4">
<p>
To develop a new experiment based on successive refinement of an
already implemented system, we need to make small changes to the
existing system and we can leverage the existing system to build the
new one.
</p>

<p>
To demonstrate this, we take an example of building the <code>Adjacent
Order Machine</code> that is similar the order machine but adds one more
constraint to system.
</p>
</div>

<div id="outline-container-orgabc2a45" class="outline-3">
<h3 id="orgabc2a45"><span class="section-number-3">4.1</span> From Order Machine to Adjacent Order Machine</h3>
<div class="outline-text-3" id="text-4-1">
</div>
<div id="outline-container-org3b83968" class="outline-4">
<h4 id="org3b83968"><span class="section-number-4">4.1.1</span> State</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
The state space of the basic transition system for Adjacent Order
machine remains the same as that of Order Machine.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="orgdd7ef47"><span style="color: #a020f0;">type</span> <span style="color: #a020f0;">alias</span> <span style="color: #228b22;">AdjOrderMachineState</span> <span style="color: #483d8b;">=</span> <span style="color: #228b22;">List</span> <span style="color: #228b22;">Int</span>
</pre>
</div>

<p>
The state space of the Adjacent Order experiment consists of the state
of the order machine and the state of selections.  Selections are used
to keep track of selected indices.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="org6098f65"><span style="color: #a020f0;">type</span> <span style="color: #a020f0;">alias</span> <span style="color: #228b22;">State</span> <span style="color: #483d8b;">=</span>
    <span style="color: #a020f0;">{</span> lst<span style="color: #483d8b;">:</span> <span style="color: #228b22;">AdjOrderMachineState</span>
    <span style="color: #a020f0;">,</span> selections<span style="color: #483d8b;">:</span> <span style="color: #228b22;">Selections</span>
    <span style="color: #a020f0;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab9c72b" class="outline-4">
<h4 id="orgab9c72b"><span class="section-number-4">4.1.2</span> Actions</h4>
<div class="outline-text-4" id="text-4-1-2">
<p>
Actions in the basic transition system for Adjacent Order Machine are
similar to the actions in the Order machine.  Instead of the <code>Order</code>
action here we have <code>AdjOrder</code> action.  This action corresponds to
ordering of adjacent items in the list.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Action</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">AdjOrder i</td>
<td class="org-left">Perform Adjacent Order operation at index i on the list.</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-elm" id="org99d91b1"><span style="color: #a020f0;">type</span> <span style="color: #228b22;">AdjOrderMachineAction</span> <span style="color: #483d8b;">=</span> <span style="color: #228b22;">AdjOrder</span> <span style="color: #228b22;">Int</span>
</pre>
</div>

<p>
The <code>Select</code> and <code>Deselect</code> actions are modified to select or deselect
adjacent items in the list.  So, clicking on any item <code>i</code> will select
a pair of items <code>i</code> and <code>i+1</code>.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="orgababdb1"><span style="color: #a020f0;">type</span> <span style="color: #228b22;">Action</span> <span style="color: #483d8b;">=</span> <span style="color: #228b22;">AdjOrderAction</span> <span style="color: #228b22;">AdjOrderMachineAction</span>
            <span style="color: #483d8b;">|</span> <span style="color: #228b22;">Select</span> <span style="color: #228b22;">Int</span>
            <span style="color: #483d8b;">|</span> <span style="color: #228b22;">Deselect</span> <span style="color: #228b22;">Int</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga9ef28a" class="outline-4">
<h4 id="orga9ef28a"><span class="section-number-4">4.1.3</span> Transition Function</h4>
<div class="outline-text-4" id="text-4-1-3">
<p>
The <code>adjOrderUpdate</code> function defines the transition function for the
basic transition system of the <i>Adjacent Order Machine</i>.  There is
only one action in this machine that corresponds to ordering adjacent
items in the list.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="orgcca58ae"><span style="color: #0000ff;">adjorderUpdate</span><span style="color: #483d8b;">:</span> <span style="color: #228b22;">AdjOrderMachineAction</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">AdjOrderMachineState</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">AdjOrderMachineState</span>
<span style="color: #0000ff;">adjorderUpdate</span> action state <span style="color: #483d8b;">=</span>
    <span style="color: #a020f0;">case</span> action <span style="color: #a020f0;">of</span>
        <span style="color: #228b22;">AdjOrder</span> i <span style="color: #483d8b;">-&gt;</span> adjorder i state
</pre>
</div>

<p>
The <code>update</code> function defines the transition function for the
<i>Adjacent Order Machine</i> experiment.  In addition to the list, this
system also keeps track of the indices where order action is
performed.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="org92fd3e5"><span style="color: #0000ff;">update</span><span style="color: #483d8b;">:</span> <span style="color: #228b22;">Action</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">State</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">State</span>
<span style="color: #0000ff;">update</span> action state <span style="color: #483d8b;">=</span>
    <span style="color: #a020f0;">case</span> action <span style="color: #a020f0;">of</span>
        <span style="color: #228b22;">AdjOrderAction</span> m <span style="color: #483d8b;">-&gt;</span> 
            <span style="color: #a020f0;">{</span> state <span style="color: #483d8b;">|</span> lst <span style="color: #483d8b;">=</span> adjorderUpdate m state<span style="color: #483d8b;">.</span>lst
                    <span style="color: #a020f0;">,</span> selections <span style="color: #483d8b;">=</span> <span style="color: #228b22;">NoneSelected</span> 
            <span style="color: #a020f0;">}</span>

        <span style="color: #228b22;">Select</span> i <span style="color: #483d8b;">-&gt;</span> 
            <span style="color: #a020f0;">if</span> i <span style="color: #483d8b;">&lt;</span> <span style="color: #228b22;">List</span><span style="color: #483d8b;">.</span>length state<span style="color: #483d8b;">.</span>lst <span style="color: #483d8b;">-</span> 1 <span style="color: #a020f0;">then</span> 
                { state <span style="color: #483d8b;">|</span> selections <span style="color: #483d8b;">=</span> adjselect i state<span style="color: #483d8b;">.</span>selections }
            <span style="color: #a020f0;">else</span> state

        <span style="color: #228b22;">Deselect</span> i <span style="color: #483d8b;">-&gt;</span> { state <span style="color: #483d8b;">|</span> selections <span style="color: #483d8b;">=</span> adjdeselect i state<span style="color: #483d8b;">.</span>selections }
</pre>
</div>
</div>
</div>


<div id="outline-container-org479a9c9" class="outline-4">
<h4 id="org479a9c9"><span class="section-number-4">4.1.4</span> View</h4>
<div class="outline-text-4" id="text-4-1-4">
<p>
The html mapping for the experiment consists of a visual mapping for
the list and the button to trigger adjacent order action.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="orgd36a434"><span style="color: #0000ff;">view</span><span style="color: #483d8b;">:</span> <span style="color: #228b22;">State</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Html</span> <span style="color: #228b22;">Action</span>
<span style="color: #0000ff;">view</span> state <span style="color: #483d8b;">=</span>
    <span style="color: #228b22;">Html</span><span style="color: #483d8b;">.</span>div
        []
        <span style="color: #a020f0;">[</span> listView state
        <span style="color: #a020f0;">,</span> adjorderButton state
        <span style="color: #a020f0;">]</span>
</pre>
</div>
</div>


<ol class="org-ol">
<li><a id="orgb51eeef"></a>Adjacent Order Button<br />
<div class="outline-text-5" id="text-4-1-4-1">
<p>
The adjacent order button triggers <code>AdjOrder</code> action that performs the
ordering operation on the list at selected indices.
</p>

<p>
The only difference between the <code>Order</code> and <code>AdjOrder</code> action being
that adjacent ordering as the name suggests performs ordering on
adjacent items in the list.
</p>

<p>
The selection interface is such that you can only select/deselect
items in adjacent pairs.  Hence the functionality of the adjacent
order button is very much similar to the <a href="#org6a03d75">order button</a> except that
instead of <code>Order</code> action we trigger <code>AdjOrder</code> action.
</p>

<div class="org-src-container">
<pre class="src src-elm" id="org9ec8a6e"><span style="color: #0000ff;">adjorderButton</span> <span style="color: #483d8b;">:</span> <span style="color: #228b22;">State</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Html</span> <span style="color: #228b22;">Action</span>
<span style="color: #0000ff;">adjorderButton</span> state <span style="color: #483d8b;">=</span> 
    <span style="color: #a020f0;">let</span>
        attrlst <span style="color: #483d8b;">=</span> <span style="color: #a020f0;">if</span> active state <span style="color: #a020f0;">then</span>
                      activeStyle state<span style="color: #483d8b;">.</span>selections
                  <span style="color: #a020f0;">else</span> 
                      inactiveStyle
    <span style="color: #a020f0;">in</span>
        <span style="color: #228b22;">Html</span><span style="color: #483d8b;">.</span>div []
            <span style="color: #a020f0;">[</span> <span style="color: #228b22;">Html</span><span style="color: #483d8b;">.</span>button
                (commonStyles <span style="color: #483d8b;">++</span> attrlst)
                [<span style="color: #228b22;">Html</span><span style="color: #483d8b;">.</span>text <span style="color: #8b2252;">"ORDER"</span>]
            <span style="color: #a020f0;">]</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-elm" id="orgb8dc7d3"><span style="color: #0000ff;">inactiveStyle</span> <span style="color: #483d8b;">=</span> [ style <span style="color: #8b2252;">"background"</span> <span style="color: #8b2252;">"#E0E0E0"</span> ]

<span style="color: #0000ff;">activeStyle</span> selections <span style="color: #483d8b;">=</span>
    <span style="color: #a020f0;">case</span> selections <span style="color: #a020f0;">of</span>
        <span style="color: #228b22;">BothSelected</span> i j <span style="color: #483d8b;">-&gt;</span> 
            <span style="color: #a020f0;">[</span> onClick (<span style="color: #228b22;">AdjOrderAction</span> (<span style="color: #228b22;">AdjOrder</span> i))
            <span style="color: #a020f0;">,</span> style <span style="color: #8b2252;">"background"</span> <span style="color: #8b2252;">"#E0F2F1"</span>
            <span style="color: #a020f0;">]</span>
        _ <span style="color: #483d8b;">-&gt;</span> []

<span style="color: #0000ff;">commonStyles</span> <span style="color: #483d8b;">=</span> 
    <span style="color: #a020f0;">[</span> style <span style="color: #8b2252;">"padding"</span> <span style="color: #8b2252;">"0.5em"</span>
    <span style="color: #a020f0;">,</span> style <span style="color: #8b2252;">"font-weight"</span> <span style="color: #8b2252;">"bold"</span>
    <span style="color: #a020f0;">]</span>

<span style="color: #0000ff;">active</span><span style="color: #483d8b;">:</span> <span style="color: #228b22;">State</span> <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">Bool</span>
<span style="color: #0000ff;">active</span> state <span style="color: #483d8b;">=</span>
    <span style="color: #a020f0;">case</span> state<span style="color: #483d8b;">.</span>selections <span style="color: #a020f0;">of</span>
        <span style="color: #228b22;">BothSelected</span> i j <span style="color: #483d8b;">-&gt;</span>
            (<span style="color: #228b22;">Core</span><span style="color: #483d8b;">.</span>outOfOrder i j state<span style="color: #483d8b;">.</span>lst)
        _ <span style="color: #483d8b;">-&gt;</span> <span style="color: #228b22;">False</span>            
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: ojas</p>
<p class="date">Created: 2020-12-12 Sat 12:39</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
